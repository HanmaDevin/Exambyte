<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Neue Frage erstellen</title>
    <link href="../../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <script>
        let answerCount = [[${multipleChoiceQuestionDto.answers != null ? multipleChoiceQuestionDto.answers.size() : 0}]];

        function addAnswerField() {
            const container = document.getElementById('answersContainer');
            const newField = document.createElement('div');
            newField.className = 'mb-3 p-3 border rounded d-flex align-items-center bg-light';
            answerCount++;
            newField.innerHTML = `
                <label for="answerText${answerCount}" class="form-label visually-hidden">Antwort ${answerCount}</label>
                <input type="text" class="form-control me-2" id="answerText${answerCount}" name="answerTexts[]" placeholder="Antwort ${answerCount}" required>
                <input type="hidden" name="answerBooleans[]" value="false">
                <input type="checkbox" class="form-check-input" id="correct${answerCount}" onclick="toggleCheckbox(this, ${answerCount})">
                <label for="correct${answerCount}" class="ms-1">Korrekt</label>
            `;
            container.appendChild(newField);
        }
        function toggleCheckbox(checkbox) {
            const hiddenField = checkbox.previousElementSibling;
            hiddenField.value = checkbox.checked ? 'true' : 'false';
        }
        function removeAnswerField() {
            const container = document.getElementById('answersContainer');
            if (answerCount > 0) {
                container.removeChild(container.lastElementChild);
                answerCount--;
            }
        }

    </script>
</head>


<body>
<div class="container mt-5">
    <div class="col-md-8 offset-md-2">
        <!-- Error Message Box -->
        <div class="alert alert-danger" th:if="${error}" role="alert">
            <strong>Fehler:</strong> <span th:text="${error}"></span>
        </div>

        <!-- Success Message Box -->
        <div class="alert alert-success" th:if="${createdQuestion != null}" role="alert">
            <strong>Erfolgreich hinzugefügt: </strong><span th:text="${createdQuestion.getQuestionText()}"></span>
        </div>

        <h1 class="text-center mb-4">Neue Multiple-Choice Frage erstellen</h1>
        <form method="post" th:action="@{/organizer/tests/{testId}/mc-question(testId=${testId})}" >
            <div class="mb-4">
                <label for="questionText" class="form-label">Frage</label>
                <input type="text" class="form-control" id="questionText" name="questionText" th:value="${multipleChoiceQuestionDto.questionText}" required>
            </div>

            <div class="mb-4" id="answersContainer">
                <label class="form-label">Antwortmöglichkeiten</label>
                <div th:each="answer, iterStat : ${multipleChoiceQuestionDto.answers}" class="mb-3 p-3 border rounded d-flex align-items-center bg-light">
                    <input type="text" class="form-control me-2" th:id="'answerText' + ${iterStat.index + 1}" th:name="'answerTexts[' + ${iterStat.index} + ']" th:value="${answer.text}" placeholder="Antwort" required>
                    <input type="hidden" th:name="'answerBooleans[' + ${iterStat.index} + ']" th:value="${answer.correct ? 'true' : 'false'}">
                    <input type="checkbox" class="form-check-input" th:id="'correct' + ${iterStat.index + 1}" th:checked="${answer.correct}" onclick="toggleCheckbox(this)">
                    <label th:for="'correct' + ${iterStat.index + 1}" class="ms-1">Korrekt</label>
                </div>
            </div>

            <button type="button" class="btn btn-primary me-2" onclick="addAnswerField()">Antwort hinzufügen</button>

            <button type="button" class="btn btn-primary me-2" onclick="removeAnswerField()">Antwort entfernen</button>


            <div class="mb-4">
                <label for="score" class="form-label">Punktzahl</label>
                <input type="number" class="form-control" id="score" name="maxScore" th:value="${multipleChoiceQuestionDto.maxScore}" required>
            </div>

            <div class="mb-4">
                <label for="explanation" class="form-label">Erklärung</label>
                <textarea class="form-control" id="explanation" name="explanation" rows="3" required th:text="${multipleChoiceQuestionDto.explanation}"></textarea>
            </div>

            <div class="d-flex justify-content-between">
                <button type="submit" class="btn btn-success">Frage hinzufügen</button>
                <div>
                    <a href="#" th:href="@{/organizer/tests}" class="btn btn-outline-secondary">Zurück</a>
                    <button type="reset" class="btn btn-danger">Zurücksetzen</button>
                </div>
            </div>
        </form>
    </div>
</div>
</body>
</html>
